{% extends 'base.html' %}  <!-- Extend your base template -->

{% block content %}
<div class="container">
    <!-- Featured Movies Section -->
    <div class="clearfix"></div>
    <section class="mt-5">
        <div class="container">
            <h2>Featured Movies
                <a href="{% url 'movie_list' %}" class="btn btn-outline-primary">See All</a>
            </h2>
            <hr>
            <div class="row row-cols-4">
            {% for movie in featured_movies %}
            <div class="col">
                <!-- Movie Card -->
                <div class="card img-fluid mb-3">
                    <img src="{{ movie.image_url }}" class="card-img-top" alt="{{ movie.title }}">
                    <div class="card-img-overlay text-center bg-dark">
                        <h4 class="card-title">{{ movie.title }}</h4>
                        <a href="{% url 'movie_detail' movie.id %}" class="btn btn-outline-primary">Play</a>
                        <a class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#thrillerModal{{ movie.id }}">Trailer</a>
                    </div>
                </div>
            </div>
                <!-- Movies Modal -->
                <div class="modal fade bg-dark" id="thrillerModal{{ movie.id }}" tabindex="-1" aria-labelledby="thrillerModalLabel{{ movie.id }}" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content p-2 bg-transparent">
                            <div class="modal-header">
                                <h5 class="modal-title text-white" id="thrillerModalLabel{{ movie.id }}">Thriller for {{ movie.title }}</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="embed-responsive embed-responsive-16by9">
                                    <iframe id="myIframe{{ movie.id }}" class="embed-responsive-item" width="100%" height="450" src="{{ movie.trailer_url }}"></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
      </div>
    </section>
    <br>

    <!-- Featured Series Section -->
    <div class="clearfix"></div>
    <section>
        <h2>Featured Series
            <a href="{% url 'series_list' %}" class="btn btn-outline-primary">See All</a>
        </h2>
        <hr>
        <div class="row row-cols-4">
            {% for series in featured_series %}
            <div class="col">
                <!-- Series Card -->
                <div class="card img-fluid mb-3">
                    <img src="{{ series.image_url }}" alt="{{ series.title }}">
                    <div class="card-img-overlay text-center bg-dark">
                        <h4 class="card-title">{{ series.title }}</h4>
                        <a href="{% url 'series_detail' series.id %}" class="btn btn-outline-primary">Play</a>
                        <a class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#thrillerModal{{ series.id }}">Trailer</a>
                    </div>
                </div>
            </div>
                <!-- Series Modal -->
                <div class="modal fade bg-dark" id="thrillerModal{{ series.id }}" tabindex="-1" aria-labelledby="thrillerModalLabel{{ series.id }}" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content p-2 bg-transparent">
                            <div class="modal-header">
                                <h5 class="modal-title text-white" id="thrillerModalLabel{{ series.id }}">Thriller for {{ series.title }}</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="embed-responsive embed-responsive-16by9">
                                    <iframe id="myIframe{{ series.id }}" class="embed-responsive-item" width="100%" height="450" src="{{ series.trailer_url }}"></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </section>
    <!-- Additional sections can be added here -->
</div>

    <script>
        //Movies Function to handle modal close and stop the video
        function setupModalHandler(modalId, iframeId) {
            var modal = document.getElementById(modalId);
            var iframe = document.getElementById(iframeId);
            var iframeSrc = iframe.src;

            // Event handler for when the modal is about to be hidden
            modal.addEventListener('hide.bs.modal', function () {
                iframe.src = ""; // Remove the src attribute of the iframe
            });

            // Optional: Reset the iframe src when reopening the modal
            modal.addEventListener('show.bs.modal', function () {
                iframe.src = iframeSrc;
            });
        }

        // Loop through all movies and setup handlers
        {% for movie in featured_movies %}
            setupModalHandler("thrillerModal{{ movie.id }}", "myIframe{{ movie.id }}");
        {% endfor %}

        //Series Function to handle modal close and stop the video
        function setupModalHandler(modalId, iframeId) {
            var modal = document.getElementById(modalId);
            var iframe = document.getElementById(iframeId);
            var iframeSrc = iframe.src;

            // Event handler for when the modal is about to be hidden
            modal.addEventListener('hide.bs.modal', function () {
                iframe.src = ""; // Remove the src attribute of the iframe
            });

            // Optional: Reset the iframe src when reopening the modal
            modal.addEventListener('show.bs.modal', function () {
                iframe.src = iframeSrc;
            });
        }

        // Loop through all movies and setup handlers
        {% for series in featured_series %}
            setupModalHandler("thrillerModal{{ series.id }}", "myIframe{{ series.id }}");
        {% endfor %}
    </script>
{% endblock %}
