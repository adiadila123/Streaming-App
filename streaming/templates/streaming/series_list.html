{% extends 'base.html' %}  <!-- Extend your base template -->

{% block title %}Series{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1>TV Series List</h1>

    <!-- Series List -->
    <div class="row row-cols-4">
        {% for series in series %}
            <div class="col">
                <!-- Series Card -->
                <div class="card img-fluid mb-3">
                    <img src="{{ series.image_url }}" alt="{{ series.title }}">
                    <div class="card-img-overlay text-center bg-dark">
                        <h4 class="card-title">{{ series.title }}</h4>
                        <a href="{% url 'series_detail' series.id %}" class="btn btn-outline-primary">Play</a>
                        <a class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#thrillerModal{{ series.id }}">Trailer</a>
                    </div>
                </div>
            </div>

                        <!-- Thriller Modal -->
                <div class="modal fade bg-dark" id="thrillerModal{{ series.id }}" tabindex="-1" aria-labelledby="thrillerModalLabel{{ series.id }}" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content p-2 bg-transparent">
                            <div class="modal-header">
                                <h5 class="modal-title text-white" id="thrillerModalLabel{{ series.id }}">Thriller for {{ series.title }}</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="embed-responsive embed-responsive-16by9">
                                    <iframe id="myIframe{{ series.id }}" class="embed-responsive-item" width="100%" height="450" src="{{ series.trailer_url }}"></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        {% empty %}
            <p>No series available.</p>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% include 'streaming/paginator.html' %}
</div>

    <script>
    //Series Function to handle modal close and stop the video
        function setupModalHandler(modalId, iframeId) {
            var modal = document.getElementById(modalId);
            var iframe = document.getElementById(iframeId);
            var iframeSrc = iframe.src;

            // Event handler for when the modal is about to be hidden
            modal.addEventListener('hide.bs.modal', function () {
                iframe.src = ""; // Remove the src attribute of the iframe
            });

            // Optional: Reset the iframe src when reopening the modal
            modal.addEventListener('show.bs.modal', function () {
                iframe.src = iframeSrc;
            });
        }

        // Loop through all movies and setup handlers
        {% for series in series %}
            setupModalHandler("thrillerModal{{ series.id }}", "myIframe{{ series.id }}");
        {% endfor %}
    </script>
{% endblock %}
